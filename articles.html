<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StormBlogs</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js"></script>
    <script>
        // Initialize Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAnuHbSv6BniMyf3ltSZTSrIFa_92bHB-o",
        authDomain: "storm-blogs.firebaseapp.com",
        projectId: "storm-blogs",
        storageBucket: "storm-blogs.firebasestorage.app",
        messagingSenderId: "158567556221",
        appId: "1:158567556221:web:855dfa074fc5b65e68fd14"

        };

        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore(app);

        document.addEventListener("DOMContentLoaded", function() {
            // Fetch posts from Firestore
            db.collection("posts").get()
                .then(snapshot => {
                    if (snapshot.empty) {
                        document.getElementById("blog-feed").innerHTML = "<p style='text-align:center;'>No articles available.</p>";
                        return;
                    }

                    let feedHtml = "";
                    snapshot.forEach(doc => {
                        const post = doc.data();
                        let timeDiff = Date.now() - post.timestamp;
                        let timeAgo = formatTimeAgo(timeDiff);

                        feedHtml += `
                            <div style="border-bottom: 1px solid #ddd; padding: 16px 32px;">
                                <h4 style="margin: 0 0 8px; color: #111; cursor: pointer;" onclick="location.href='read.html?id=${doc.id}'">${post.title}</h4>
                                <p style="margin: 0; font-size: 14px; color: #777;">${post.category} • ${timeAgo} ago</p>
                                <p style="margin: 4px 0 0; font-size: 13px; color: #555;">${post.views} views • ${post.likes} likes • ${post.comments} comments</p>
                            </div>
                        `;
                    });
                    document.getElementById("blog-feed").innerHTML = feedHtml;
                })
                .catch(error => console.error("Error loading posts:", error));
        });

        function formatTimeAgo(milliseconds) {
            const seconds = Math.floor(milliseconds / 1000);
            const minutes = Math.floor(seconds / 60);
            const hours = Math.floor(minutes / 60);
            const days = Math.floor(hours / 24);
            const weeks = Math.floor(days / 7);
            const months = Math.floor(days / 30);
            const years = Math.floor(days / 365);
            
            if (years > 0) return `${years} year${years > 1 ? 's' : ''}`;
            if (months > 0) return `${months} month${months > 1 ? 's' : ''}`;
            if (weeks > 0) return `${weeks} week${weeks > 1 ? 's' : ''}`;
            if (days > 0) return `${days} day${days > 1 ? 's' : ''}`;
            if (hours > 0) return `${hours} hour${hours > 1 ? 's' : ''}`;
            if (minutes > 0) return `${minutes} minute${minutes > 1 ? 's' : ''}`;
            return `${seconds} second${seconds > 1 ? 's' : ''}`;
        }
    </script>
</head>
<body style="font-family: 'Poppins', serif; margin: 0; padding: 0; line-height: 1.6; color: #333; scroll-behavior: smooth;">
<header>
    <div style="display: flex; align-items: center; justify-content: space-between;">
        <div style="display: flex; align-items: center; margin:32px; margin-top:36px;">
            <img onclick="location.href='index.html';" src="logo.png" alt="Logo" style="margin-right: 4px; height:26px; width: 26px; cursor:pointer;">
            <h4 onclick="location.href='index.html';" style="color: #111111; margin: 0; cursor:pointer;">/Storm Blogs</h4>
        </div>
    </div>
</header>

<h3 style="margin:32px; text-align: center;">Articles</h3>
<div id="blog-feed" style="max-width: 800px; margin: auto;"></div>
</body>
</html>
