<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StormBlogs</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    
     <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js';
        import { getFirestore, collection, getDocs } from 'https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js';

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAnuHbSv6BniMyf3ltSZTSrIFa_92bHB-o",
            authDomain: "storm-blogs.firebaseapp.com",
            projectId: "storm-blogs",
            storageBucket: "storm-blogs.firebasestorage.app",
            messagingSenderId: "158567556221",
            appId: "1:158567556221:web:855dfa074fc5b65e68fd14"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Function to fetch posts
        document.addEventListener("DOMContentLoaded", function() {
            getDocs(collection(db, "posts"))
                .then(snapshot => {
                    if (snapshot.empty) {
                        document.getElementById("blog-feed").innerHTML = "<p style='text-align:center;'>No articles available.</p>";
                        return;
                    }

                    let feedHtml = "";
                    const uiClasses = [
                        "background: #8DE4AF; color: #111;",
                        "background: #111; color: #fff;",
                        "background: #D7AFFF; color: #111;",
                        "background: #FCE77D; color: #111;"
                    ];

                    snapshot.forEach(doc => {
                        const post = doc.data();
                        let timeDiff = Date.now() - post.timestamp;
                        let timeAgo = formatTimeAgo(timeDiff);
                        let truncatedContent = post.content.length > 250 ? post.content.substring(0, 247) + '...' : post.content
                        const randomClass = uiClasses[Math.floor(Math.random() * uiClasses.length)];

                        feedHtml += `
<div style="display: flex; gap: 16px; margin:0px; overflow-x: auto; scrollbar-width: none; -ms-overflow-style: none;">    
<div onclick="location.href='read.html?id=${doc.id}'" style="flex: 1; width: 250px; max-width: 250px; padding: 20px; border-radius: 12px; ${randomClass}; cursor: pointer;">
        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px;">
            <div style="display: flex; align-items: center;">
                <img src="profile.jpg" alt="Profile" style="width: 30px; height: 30px; border-radius: 50%; object-fit: cover; margin-right: 8px;">
                <span style="font-weight: 600;">Nikit Hamal</span>
            </div>
            <i class="fas fa-share-alt" onclick="event.stopPropagation(); sharePost('${doc.id}')" style="cursor: pointer;"></i>
        </div>
        <p style="font-weight:600; font-size:14px; margin: 0 0 8px 0;">${post.category}</p>
        <p style="font-weight:600; font-size:18px; margin:8px 0;">${post.title}</p>
        <p style="font-size: 14px; margin: 8px 0;">${truncatedContent}</p>
        <div style="display: flex; align-items: center; justify-content: space-between; font-size: 12px; color: #666; margin-top: 10px;">
            <span><i class="far fa-clock" style="margin-right: 5px;"></i> ${formatTimeAgo(post.timestamp)}</span>
            <span><i class="far fa-thumbs-up" style="margin-right: 5px;"></i> ${post.likes || 0}</span>
            <span><i class="far fa-comment" style="margin-right: 5px;"></i> ${post.comments || 0}</span>
            <i class="fas fa-ellipsis-h" style="cursor: pointer;"></i>
        </div>
    </div>
</div>
`;

                    });
                    document.getElementById("blog-feed").innerHTML = feedHtml;
                })
                .catch(error => console.error("Error loading posts:", error));
        });

        // Function to format time difference
        function formatTimeAgo(milliseconds) {
            const seconds = Math.floor(milliseconds / 1000);
            const minutes = Math.floor(seconds / 60);
            const hours = Math.floor(minutes / 60);
            const days = Math.floor(hours / 24);
            const weeks = Math.floor(days / 7);
            const months = Math.floor(days / 30);
            const years = Math.floor(days / 365);
            
            if (years > 0) return `${years} year${years > 1 ? 's' : ''}`;
            if (months > 0) return `${months} month${months > 1 ? 's' : ''}`;
            if (weeks > 0) return `${weeks} week${weeks > 1 ? 's' : ''}`;
            if (days > 0) return `${days} day${days > 1 ? 's' : ''}`;
            if (hours > 0) return `${hours} hour${hours > 1 ? 's' : ''}`;
            if (minutes > 0) return `${minutes} minute${minutes > 1 ? 's' : ''}`;
            return `${seconds} second${seconds > 1 ? 's' : ''}`;
        }


    </script>

</head>
<body style="font-family: 'Poppins', serif; margin: 0; padding: 0; line-height: 1.6; background-color: #FDF7F2; color: #333; scroll-behavior: smooth;">
<header>
    <div style="display: flex; align-items: center; justify-content: space-between;">
        <div style="display: flex; align-items: center; margin:32px; margin-top:36px; margin-bottom:6px;">
            <img onclick="location.href='index.html';" src="logo.png" alt="Logo" style="margin-right: 4px; height:26px; width: 26px; cursor:pointer;">
            <h4 onclick="location.href='index.html';" style="color: #111111; margin: 0; cursor:pointer;">/Storm Blogs</h4>
        </div>
    </div>
</header>
<!-- Top Navigation Bar -->
<nav style="padding: 8px 0; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 1000;">

    <!-- Links -->
    <div style="display: flex; gap: 16px; margin-right: 16px; margin-left: 20px;">
        
<a href="index.html" style="text-decoration: none; font-size: 16px; font-weight:500; padding: 8px 16px; transition: background-color 0.3s ease; color: black; position: relative;" id="home-tab">Home</a>
        
<a href="articles.html" style="text-decoration: none; border-bottom:2px solid black; font-size: 16px; font-weight:500; padding: 8px 16px; transition: background-color 0.3s ease; color: black;" id="articles-tab">Articles</a>
</nav>

<div id="blog-feed" style="display: flex; flex-wrap: wrap; gap: 16px; justify-content: flex-start; padding: 32px; margin: 0 auto; max-width: 100%;"></div>

</body>
</html>
