<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile - StormBlogs</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg-color: #FDF7F2;
            --text-color: #333;
            --primary-color: #111;
            --border-color: #eee;
            --accent-color: #FF6B6B;
            --success-color: #4CAF50;
            --warning-color: #FFC107;
        }

        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
        }

        .header {
            background: white;
            padding: 1rem 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            max-width: 1200px;
            margin: 0 auto;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
            color: var(--primary-color);
        }

        .logo img {
            height: 26px;
            width: 26px;
        }

        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 2rem;
        }

        .profile-header {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        .profile-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
        }

        .profile-info {
            flex: 1;
        }

        .profile-name-wrapper {
            display: flex;
            align-items: center;
        }

        .profile-info h1 {
            margin: 0 0 0.5rem 0;
            color: var(--primary-color);
        }

        .profile-info p {
            margin: 0;
            color: #666;
        }

        .profile-stats {
            display: flex;
            gap: 2rem;
            margin-top: 1rem;
        }

        .stat {
            text-align: center;
        }

        .stat-number {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary-color);
        }

        .stat-label {
            font-size: 0.9rem;
            color: #666;
        }

        .tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 1rem;
        }

        .tab {
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #666;
        }

        .tab.active {
            background: var(--primary-color);
            color: white;
        }

        .tab:hover:not(.active) {
            background: #f5f5f5;
        }

        .section {
            display: none;
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .section.active {
            display: block;
        }

        .edit-form {
            display: grid;
            gap: 1rem;
            max-width: 600px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            text-decoration: none;
            color: var(--primary-color);
        }

        .form-group label {
            font-weight: 500;
            color: var(--primary-color);
        }

        .form-group input, .form-group textarea {
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-family: inherit;
        }

        .form-group input:focus, .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-family: inherit;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .article-grid, .draft-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .article-card, .draft-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.3s ease;
            border: 1px solid var(--border-color);
        }

        .article-card:hover, .draft-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .card-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }

        .card-content {
            padding: 1.5rem;
        }

        .card-title {
            margin: 0 0 1rem 0;
            color: var(--primary-color);
        }

        .card-meta {
            display: flex;
            justify-content: space-between;
            color: #666;
            font-size: 0.9rem;
        }

        .settings-grid {
            display: grid;
            gap: 1.5rem;
        }

        .settings-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid var(--border-color);
        }

        .settings-card h3 {
            margin: 0 0 1rem 0;
            color: var(--primary-color);
        }

        @media (max-width: 768px) {
            .profile-header {
                flex-direction: column;
                text-align: center;
            }

            .profile-stats {
                justify-content: center;
            }

            .tabs {
                overflow-x: auto;
                padding-bottom: 0.5rem;
            }

            .article-grid, .draft-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Add loading overlay styles */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-color);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            opacity: 1;
            transition: opacity 0.3s ease-out;
        }

        .loading-overlay.fade-out {
            opacity: 0;
            pointer-events: none;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .card-description {
            color: #666;
            margin: 0.5rem 0;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
            line-height: 1.5;
        }

        .profile-pictures-history {
            margin-top: 1.5rem;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 1rem;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .history-item {
            text-align: center;
        }

        .history-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .history-avatar:hover {
            transform: scale(1.1);
            border-color: var(--primary-color);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .history-date {
            font-size: 0.8rem;
            color: #666;
            margin-top: 0.5rem;
        }

        .history-item {
            position: relative;
        }

        .history-item::before {
            content: 'Use this';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
            z-index: 1;
        }

        .history-item:hover::before {
            opacity: 1;
        }

        @media (max-width: 768px) {
            .profile-pictures-history {
                grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
            }

            .history-avatar {
                width: 60px;
                height: 60px;
            }
        }

        .insights-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
        }

        .insights-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .insights-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-top: 1rem;
        }

        .stat-item {
            text-align: center;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #666;
        }

        .popular-articles {
            margin-top: 1rem;
        }

        .popular-article-item {
            display: flex;
            align-items: center;
            padding: 1rem;
            border-bottom: 1px solid #eee;
            transition: all 0.3s ease;
        }

        .popular-article-item:hover {
            background: #f8f9fa;
        }

        .article-rank {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-right: 1rem;
            min-width: 30px;
        }

        .article-info {
            flex: 1;
        }

        .article-title {
            font-weight: 500;
            margin-bottom: 0.25rem;
        }

        .article-stats {
            font-size: 0.85rem;
            color: #666;
            display: flex;
            gap: 1rem;
        }

        .chart-container {
            height: 300px;
            margin-top: 1rem;
        }

        @media (max-width: 768px) {
            .insights-grid {
                grid-template-columns: 1fr;
            }
        }

        .verified-badge {
            display: inline-flex;
            align-items: center;
            margin-left: 8px;
            color: #3b82f6;
            font-size: 1.2rem;
        }

        .pro-only {
            position: relative;
        }

        .pro-only::after {
            content: 'PRO';
            position: absolute;
            top: -8px;
            right: -8px;
            background: #3b82f6;
            color: white;
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 12px;
            font-weight: 600;
        }

        .profile-viewers {
            margin-top: 1rem;
            padding: 1rem;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .viewer-item {
            display: flex;
            align-items: center;
            padding: 0.75rem;
            border-bottom: 1px solid #eee;
        }

        .viewer-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 1rem;
        }

        .viewer-info {
            flex: 1;
        }

        .viewer-name {
            font-weight: 500;
            margin-bottom: 0.25rem;
        }

        .viewer-date {
            font-size: 0.85rem;
            color: #666;
        }

        .stats-row {
            display: flex;
            gap: 1rem;
            margin-top: 0.5rem;
        }
        .stats-row span {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            color: #666;
            font-size: 0.85rem;
        }
        .stats-row i {
            font-size: 1rem;
        }

        .social-inputs {
            display: grid;
            gap: 1rem;
        }

        .social-input {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: #f5f5f5;
            padding: 0.5rem;
            border-radius: 8px;
        }

        .social-input i {
            width: 24px;
                text-align: center;
            color: #666;
        }

        .social-input input {
            border: none;
            background: transparent;
            flex: 1;
        }

        .social-input input:focus {
            outline: none;
        }

        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .checkbox-group label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
        }

        .avatar-upload {
            position: relative;
            width: 120px;
                margin: 0 auto;
            }

        .avatar-edit {
            position: absolute;
            right: 0;
            bottom: 0;
            z-index: 1;
        }

        .avatar-edit input {
            display: none;
        }

        .avatar-edit label {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 34px;
            height: 34px;
            margin-bottom: 0;
            border-radius: 100%;
            background: var(--primary-color);
            border: 1px solid transparent;
            cursor: pointer;
            font-weight: normal;
            transition: all 0.2s ease-in-out;
        }

        .avatar-edit label:hover {
            background: #000;
            transform: scale(1.05);
        }

        .avatar-edit label i {
            color: white;
            font-size: 14px;
        }

        .avatar-preview {
            position: relative;
            width: 120px;
            height: 120px;
            border-radius: 100%;
            border: 3px solid var(--primary-color);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            overflow: hidden;
            background: #f8f9fa;
        }

        .avatar-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .avatar-preview .default-avatar {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            color: #adb5bd;
        }

        .avatar-preview::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.4);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .avatar-preview:hover::after {
            opacity: 1;
        }

        .avatar-preview:hover .upload-text {
            opacity: 1;
        }

        .upload-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 0.8rem;
            text-align: center;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 2;
            pointer-events: none;
        }

        .avatar-requirements {
            text-align: center;
            color: #666;
            font-size: 0.8rem;
            margin-top: 0.5rem;
        }

        .level-info {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            position: relative;
        }

        .level-header {
            margin-bottom: 2rem;
        }

        .level-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin: 0;
            color: var(--primary-color);
        }

        .level-subtitle {
            color: #666;
            margin: 0.5rem 0 0 0;
            font-size: 1.1rem;
        }

        .level-badge {
            background: linear-gradient(90deg, #FF8A8A, #FFC947);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 50px;
            font-weight: 600;
            font-size: 1.1rem;
            box-shadow: 0 2px 10px rgba(255, 107, 107, 0.2);
            position: absolute;
            right: 2rem;
            top: 2rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .level-badge i {
            font-size: 1.2rem;
        }

        .level-progress {
            width: 100%;
            height: 6px;
            background: #f0f0f0;
            border-radius: 20px;
            overflow: hidden;
            margin: 1.5rem 0 1rem;
            position: relative;
        }

        .level-progress .progress-bar {
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            background: linear-gradient(90deg, #FF8A8A, #FFC947);
            border-radius: 20px;
            transition: width 0.3s ease;
        }

        .level-stats {
            display: flex;
            justify-content: space-between;
            color: #666;
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }

        .achievements-section {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .achievements-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .achievements-title {
            font-size: 1.8rem;
            font-weight: 600;
            margin: 0;
            color: var(--primary-color);
        }

        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1.5rem;
        }

        .achievement-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            position: relative;
            overflow: hidden;
            border: 1px solid #eee;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .achievement-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #FF8A8A, #FFC947);
        }

        .achievement-icon {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: #FF8A8A;
            margin-bottom: 1rem;
        }

        .achievement-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin: 0 0 0.5rem;
            color: var(--primary-color);
        }

        .achievement-description {
            color: #666;
            font-size: 0.9rem;
            margin: 0 0 1rem;
        }

        .achievement-progress {
            margin-top: 1rem;
            font-size: 0.9rem;
            color: #666;
        }

        .achievement-progress .progress-bar {
            margin-top: 0.5rem;
            width: 100%;
            height: 4px;
            background: #f0f0f0;
            border-radius: 2px;
            overflow: hidden;
            position: relative;
        }

        .achievement-progress .progress-bar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            width: var(--progress);
            background: linear-gradient(90deg, #FF8A8A, #FFC947);
            border-radius: 2px;
            transition: width 0.3s ease;
        }

        .posts-section {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .posts-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .posts-title {
            font-size: 1.8rem;
            font-weight: 600;
            margin: 0;
            color: var(--primary-color);
        }

        .posts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .post-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.3s ease;
            border: 1px solid var(--border-color);
            cursor: pointer;
        }

        .post-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .post-card .card-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }

        .post-card .card-content {
            padding: 1.5rem;
        }

        .post-card .card-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin: 0 0 0.5rem;
            color: var(--primary-color);
        }

        .post-card .card-description {
            color: #666;
            font-size: 0.9rem;
            margin: 0 0 1rem;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .post-card .card-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: #666;
            font-size: 0.9rem;
        }

        .post-card .stats-row {
            display: flex;
            gap: 1rem;
        }

        .post-card .stats-row span {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .post-card .stats-row i {
            font-size: 1rem;
            color: var(--accent-color);
        }

        @media (max-width: 768px) {
            .posts-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Add loading overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
    </div>

    <header class="header">
        <div class="header-content">
            <a href="index.html" class="logo">
                <img src="logo.png" alt="Logo">
                <h4 style="margin: 0;">/Storm Blogs</h4>
            </a>
        </div>
    </header>

    <div class="container">
        <div class="profile-header">
            <img src="profile.jpg" alt="Profile" class="profile-avatar" id="profileAvatar">
            <div class="profile-info">
                <div class="profile-name-wrapper">
                    <h1 id="profileName">User Name</h1>
                    <span id="verifiedBadge" class="verified-badge" style="display: none;">
                        <i class="fas fa-check-circle"></i>
                    </span>
                </div>
                <p id="profileEmail">user@email.com</p>
                <p id="profileBio">A passionate writer and storyteller.</p>
                <div class="profile-stats">
                    <div class="stat">
                        <div class="stat-number" id="articlesCount">0</div>
                        <div class="stat-label">Articles</div>
                    </div>
                    <div class="stat">
                        <div class="stat-number" id="viewsCount">0</div>
                        <div class="stat-label">Views</div>
                    </div>
                    <div class="stat">
                        <div class="stat-number" id="likesCount">0</div>
                        <div class="stat-label">Likes</div>
                    </div>
                    <div class="stat">
                        <div class="stat-number" id="commentsCount">0</div>
                        <div class="stat-label">Comments</div>
                    </div>
                    <div class="stat pro-only" id="profileViewsStat" style="display: none;">
                        <div class="stat-number" id="profileViewsCount">0</div>
                        <div class="stat-label">Profile Views</div>
                    </div>
                </div>
            </div>
            </div>
            
        <div class="tabs">
            <div class="tab" data-tab="drafts">
                <i class="fas fa-file-alt"></i> My Drafts
            </div>
            <div class="tab" data-tab="insights">
                <i class="fas fa-chart-line"></i> Insights
            </div>
            <div class="tab" data-tab="edit">
                <i class="fas fa-edit"></i> Edit Profile
            </div>
            <div class="tab" data-tab="settings">
                <i class="fas fa-cog"></i> Settings
            </div>
        </div>

        <div class="section" id="drafts">
            <div class="draft-grid" id="draftsGrid">
                <!-- Drafts will be dynamically added here -->
                    </div>
                    </div>

        <div class="section" id="insights">
            <div class="insights-grid">
                <div class="insights-card">
                    <h3>Performance Overview</h3>
                    <div class="insights-stats">
                        <div class="stat-item">
                            <div class="stat-value" id="totalViews">0</div>
                            <div class="stat-label">Total Views</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="totalReadTime">0</div>
                            <div class="stat-label">Read Time (mins)</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="totalLikes">0</div>
                            <div class="stat-label">Total Likes</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="totalComments">0</div>
                            <div class="stat-label">Total Comments</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="interactionRate">0%</div>
                            <div class="stat-label">Interaction Rate</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="avgReadTime">0</div>
                            <div class="stat-label">Avg. Read Time</div>
                        </div>
                    </div>
                </div>
                <div class="insights-card">
                    <h3>Popular Articles</h3>
                    <div id="popularArticles" class="popular-articles">
                        <!-- Will be populated dynamically -->
                    </div>
                </div>
                <div class="insights-card">
                    <h3>Reading Time Distribution</h3>
                    <div id="readTimeChart" class="chart-container">
                        <!-- Will be populated with chart -->
                    </div>
                </div>
                <div class="insights-card">
                    <h3>Engagement Trends</h3>
                    <div id="engagementChart" class="chart-container">
                        <!-- Will be populated with chart -->
                    </div>
                </div>
                <div class="insights-card pro-only" id="profileViewersCard" style="display: none;">
                    <h3>Profile Viewers</h3>
                    <div id="profileViewers" class="profile-viewers">
                        <!-- Will be populated dynamically -->
                    </div>
                </div>
                <div class="insights-card">
                    <h3>Interaction Breakdown</h3>
                    <div id="interactionChart" class="chart-container">
                        <!-- Will be populated with chart -->
                    </div>
                </div>
                    </div>
                </div>

        <div class="section" id="edit">
            <form class="edit-form" id="editProfileForm">
                <div class="form-group">
                    <label for="name">Display Name *</label>
                    <input type="text" id="name" name="name" required>
                </div>
                <div class="form-group">
                    <label for="username">Username *</label>
                    <input type="text" id="username" name="username" required pattern="[a-zA-Z0-9_]{3,20}" 
                        title="Username must be 3-20 characters long and can only contain letters, numbers, and underscores">
            </div>
                <div class="form-group">
                    <label for="bio">Bio</label>
                    <textarea id="bio" name="bio" rows="4" placeholder="Tell us about yourself..."></textarea>
                </div>
                <div class="form-group">
                    <label for="location">Location</label>
                    <input type="text" id="location" name="location" placeholder="City, Country">
                </div>
                <div class="form-group">
                    <label for="website">Personal Website</label>
                    <input type="url" id="website" name="website" placeholder="https://your-website.com">
                </div>
                <div class="form-group">
                    <label for="occupation">Occupation</label>
                    <input type="text" id="occupation" name="occupation" placeholder="What do you do?">
                </div>
                <div class="form-group">
                    <label for="interests">Interests</label>
                    <input type="text" id="interests" name="interests" placeholder="Comma-separated list of interests">
                </div>
                <div class="form-group">
                    <label for="avatar">Profile Picture</label>
                    <div class="avatar-upload">
                        <div class="avatar-edit">
                            <input type="file" id="avatar" name="avatar" accept="image/*" onchange="previewImage(event)">
                            <label for="avatar">
                                <i class="fas fa-camera"></i>
                            </label>
                        </div>
                        <div class="avatar-preview">
                            <div class="default-avatar" id="defaultAvatar">
                                <i class="fas fa-user"></i>
                            </div>
                            <img src="" alt="Avatar Preview" id="avatarPreview" style="display: none;">
                            <div class="upload-text">Change Photo</div>
                        </div>
                    </div>
                    <div class="avatar-requirements">
                        Recommended: Square image, max 5MB
                    </div>
                    <div class="profile-pictures-history" id="profilePicturesHistory">
                        <h4 style="grid-column: 1/-1; margin: 0 0 1rem 0; color: #666;">Previous Profile Pictures</h4>
                        <!-- Profile pictures history will be added here -->
                    </div>
                </div>
                <div class="form-group">
                    <label>Social Media Links</label>
                    <div class="social-inputs">
                        <div class="social-input">
                            <i class="fab fa-instagram"></i>
                            <input type="text" id="instagram" placeholder="Instagram username">
                        </div>
                        <div class="social-input">
                            <i class="fab fa-twitter"></i>
                            <input type="text" id="twitter" placeholder="Twitter username">
                        </div>
                        <div class="social-input">
                            <i class="fab fa-linkedin"></i>
                            <input type="text" id="linkedin" placeholder="LinkedIn username">
                        </div>
                        <div class="social-input">
                            <i class="fab fa-github"></i>
                            <input type="text" id="github" placeholder="GitHub username">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>Privacy Settings</label>
                    <div class="checkbox-group">
                        <label>
                            <input type="checkbox" id="showEmail"> Show email on profile
                        </label>
                        <label>
                            <input type="checkbox" id="showLocation"> Show location on profile
                        </label>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary">Save Changes</button>
            </form>
        </div>

        <div class="section" id="settings">
            <div class="settings-grid">
                <div class="settings-card">
                    <h3>Account Settings</h3>
                    <form class="edit-form">
                        <div class="form-group">
                            <label for="email">Email</label>
                            <input type="email" id="email" name="email" required>
                        </div>
                        <div class="form-group">
                            <label for="currentPassword">Current Password</label>
                            <input type="password" id="currentPassword" name="currentPassword">
                        </div>
                        <div class="form-group">
                            <label for="newPassword">New Password</label>
                            <input type="password" id="newPassword" name="newPassword">
                        </div>
                        <button type="submit" class="btn btn-primary">Update Account</button>
                    </form>
                </div>
                <div class="settings-card">
                    <h3>Preferences</h3>
                    <form class="edit-form">
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="emailNotifications"> 
                                Receive email notifications
                            </label>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="darkMode"> 
                                Enable dark mode
                            </label>
                        </div>
                        <button type="submit" class="btn btn-primary">Save Preferences</button>
                    </form>
                </div>
            </div>
        </div>

        <div class="level-info">
            <div class="level-header">
                <h2 class="level-title">Level 1</h2>
                <p class="level-subtitle">Beginner Blogger</p>
            </div>
            <div class="level-badge">Beginner Blogger</div>
            <div class="level-progress">
                <div class="progress-bar" style="width: 0%"></div>
            </div>
            <div class="level-stats">
                <span>0 / 1000 XP</span>
                <span>Next Level: 2</span>
            </div>
        </div>

        <div class="achievements-section">
            <div class="achievements-header">
                <h2 class="achievements-title">Achievements</h2>
                <span>0/4 Unlocked</span>
            </div>
            <div class="achievements-grid">
                <!-- Achievement cards will be added here dynamically -->
            </div>
        </div>

        <div class="posts-section">
            <div class="posts-header">
                <h2 class="posts-title">Recent Posts</h2>
                <button class="btn btn-primary">New Post</button>
            </div>
            <div class="posts-grid">
                <!-- Posts will be dynamically added here -->
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, updateProfile, updateEmail, updatePassword } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getDatabase, ref as databaseRef, get, set, update, child, query, orderByChild, equalTo } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        import { getStorage, ref as storageRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAnuHbSv6BniMyf3ltSZTSrIFa_92bHB-o",
            authDomain: "storm-blogs.firebaseapp.com",
            projectId: "storm-blogs",
            storageBucket: "storm-blogs.firebasestorage.app",
            messagingSenderId: "158567556221",
            appId: "1:158567556221:web:855dfa074fc5b65e68fd14"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth();
        const db = getDatabase();
        const storage = getStorage();
        const IMGBB_API_KEY = 'cae25a5efbe778e17c1db8b6f4e44cd7';

        // Show loading overlay
        const loadingOverlay = document.getElementById('loadingOverlay');
        
        // Loading management functions
        function showLoading() {
            if (loadingOverlay) {
                loadingOverlay.style.display = 'flex';
                loadingOverlay.classList.remove('fade-out');
            }
        }

        function hideLoading() {
            if (loadingOverlay) {
                loadingOverlay.classList.add('fade-out');
                setTimeout(() => {
                    loadingOverlay.style.display = 'none';
                }, 300);
            }
        }

        // Toast notification system
        function showToast(message, type = 'success') {
            // Create toast container if it doesn't exist
            let toastContainer = document.getElementById('toastContainer');
            if (!toastContainer) {
                toastContainer = document.createElement('div');
                toastContainer.id = 'toastContainer';
                toastContainer.style.cssText = `
                    position: fixed;
                    bottom: 20px;
                    right: 20px;
                    z-index: 10000;
                `;
                document.body.appendChild(toastContainer);
            }

            // Create toast element
            const toast = document.createElement('div');
            toast.style.cssText = `
                padding: 12px 24px;
                margin: 8px;
                border-radius: 8px;
                color: white;
                font-size: 14px;
                opacity: 0;
                transition: opacity 0.3s ease;
                ${type === 'success' ? 'background: #10b981;' : 'background: #ef4444;'}
            `;
            toast.textContent = message;

            // Add to container and animate
            toastContainer.appendChild(toast);
            requestAnimationFrame(() => {
                toast.style.opacity = '1';
            });

            // Remove after delay
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => {
                    toastContainer.removeChild(toast);
                    if (toastContainer.children.length === 0) {
                        document.body.removeChild(toastContainer);
                    }
                }, 300);
            }, 3000);
        }

        async function uploadToImgBB(file) {
            const formData = new FormData();
            formData.append('image', file);

            try {
                const response = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_API_KEY}`, {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();
                if (data.success) {
                    return {
                        url: data.data.url,
                        deleteUrl: data.data.delete_url,
                        timestamp: new Date().toISOString()
                    };
                } else {
                    throw new Error('Failed to upload image');
                }
            } catch (error) {
                console.error('Error uploading to ImgBB:', error);
                throw error;
            }
        }

        // Handle tab switching
        const tabs = document.querySelectorAll('.tab');
        const sections = document.querySelectorAll('.section');
        const mainSections = document.querySelectorAll('.level-info, .achievements-section, .posts-section');

        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const target = tab.dataset.tab;
                
                // Update active tab
                tabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                // Update active section
                sections.forEach(s => {
                    s.classList.remove('active');
                    if (s.id === target) {
                        s.classList.add('active');
                    }
                });

                // Hide main sections when viewing other tabs
                mainSections.forEach(section => {
                    section.style.display = target === 'articles' ? 'block' : 'none';
                });

                // Update URL hash
                window.location.hash = target;
            });
        });

        // Handle hash change
        function handleHash() {
            const hash = window.location.hash.slice(1) || 'articles';
            const tab = document.querySelector(`.tab[data-tab="${hash}"]`);
            if (tab) {
                tab.click();
            }
            
            // Show/hide main sections based on initial hash
            const mainSections = document.querySelectorAll('.level-info, .achievements-section, .posts-section');
            mainSections.forEach(section => {
                section.style.display = hash === 'articles' ? 'block' : 'none';
            });
        }

        window.addEventListener('hashchange', handleHash);
        handleHash(); // Handle initial hash

        // Load user data
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                try {
                    await loadUserProfile(user);
                    hideLoading();
                } catch (error) {
                    console.error("Error loading profile:", error);
                    showToast('Error loading profile', 'error');
                    hideLoading();
                }
            } else {
                window.location.href = 'login.html';
            }
        });

        async function loadUserProfile() {
            const loadingOverlay = document.getElementById('loadingOverlay');
            try {
                const user = auth.currentUser;
                if (!user) {
                    window.location.href = 'login.html';
                    return;
                }

                // Get user document
                const userRef = databaseRef(db, 'users/' + user.uid);
                const userSnapshot = await get(userRef);
                
                if (!userSnapshot.exists()) {
                    showError('User profile not found');
                    return;
                }

                const userData = userSnapshot.val();

                // Helper function to update element text content
                function updateElement(id, value) {
                    const element = document.getElementById(id);
                    if (element) {
                        element.textContent = value;
                    }
                }

                // Helper function to update element display
                function updateDisplay(id, display) {
                    const element = document.getElementById(id);
                    if (element) {
                        element.style.display = display;
                    }
                }

                // Update profile info
                updateElement('profileName', userData.displayName || 'Anonymous');
                updateElement('profileEmail', userData.email);
                updateElement('profileBio', userData.bio || 'A passionate writer and storyteller.');

                const profileAvatar = document.getElementById('profileAvatar');
                if (profileAvatar) {
                    profileAvatar.src = userData.photoURL || `https://api.dicebear.com/7.x/avataaars/svg?seed=${user.uid}`;
                }

                // Show verification badge if applicable
                if (userData.verified) {
                    updateDisplay('verifiedBadge', 'inline');
                }

                // Update stats
                updateElement('articlesCount', userData.posts || 0);
                updateElement('viewsCount', userData.totalViews || 0);
                updateElement('likesCount', userData.totalLikes || 0);
                updateElement('commentsCount', userData.totalComments || 0);

                if (userData.isPro) {
                    updateDisplay('profileViewsStat', 'block');
                    updateElement('profileViewsCount', Object.keys(userData.profileViews || {}).length);
                }

                // Load user level and experience
                const level = userData.level || 1;
                const experience = userData.experience || 0;
                const maxXp = 1000; // Fixed 1000 XP per level
                const currentLevelXp = experience % maxXp;
                const nextLevel = level + 1;
                
                const levelTitle = document.querySelector('.level-title');
                if (levelTitle) {
                    levelTitle.textContent = `Level ${level}`;
                }

                const levelSubtitle = document.querySelector('.level-subtitle');
                if (levelSubtitle) {
                    levelSubtitle.textContent = level >= 10 ? 'Master Blogger' : level >= 5 ? 'Expert Blogger' : 'Beginner Blogger';
                }

                const levelBadge = document.querySelector('.level-badge');
                if (levelBadge) {
                    levelBadge.innerHTML = `
                        <i class="fas fa-crown" style="color: ${level >= 10 ? '#FFD700' : level >= 5 ? '#FFA500' : '#C0C0C0'};"></i>
                        ${level >= 10 ? 'Master Blogger' : level >= 5 ? 'Expert Blogger' : 'Beginner Blogger'}
                    `;
                }
                
                const progressBar = document.querySelector('.level-progress .progress-bar');
                if (progressBar) {
                    const progressPercentage = (currentLevelXp / maxXp) * 100;
                    progressBar.style.width = `${progressPercentage}%`;
                }
                
                const levelStats = document.querySelector('.level-stats');
                if (levelStats) {
                    levelStats.innerHTML = `
                        <span>${currentLevelXp} / ${maxXp} XP</span>
                        <span>Next Level: ${nextLevel}</span>
                    `;
                }

                // Load achievements
                const achievementsGrid = document.querySelector('.achievements-grid');
                if (achievementsGrid) {
                    achievementsGrid.innerHTML = '';
                    
                    const achievements = [
                        {
                            id: 'first_post',
                            title: 'First Steps',
                            description: 'Published your first post',
                            icon: 'fas fa-pen-fancy',
                            current: userData.posts || 0,
                            required: 1,
                            xp: 100
                        },
                        {
                            id: 'posts_10',
                            title: 'Prolific Writer',
                            description: 'Published 10 posts',
                            icon: 'fas fa-book',
                            current: userData.posts || 0,
                            required: 10,
                            xp: 200
                        },
                        {
                            id: 'level_5',
                            title: 'Rising Star',
                            description: 'Reached Level 5',
                            icon: 'fas fa-star',
                            current: level || 1,
                            required: 5,
                            xp: 500
                        },
                        {
                            id: 'level_10',
                            title: 'Master Writer',
                            description: 'Reached Level 10',
                            icon: 'fas fa-crown',
                            current: level || 1,
                            required: 10,
                            xp: 300
                        }
                    ];

                    let unlockedCount = 0;
                    achievements.forEach(achievement => {
                        const progress = Math.min((achievement.current / achievement.required) * 100, 100);
                        if (progress >= 100) unlockedCount++;
                        
                        achievementsGrid.innerHTML += `
                            <div class="achievement-card">
                                <div class="achievement-icon">
                                    <i class="${achievement.icon}" style="color: ${progress >= 100 ? '#FFC947' : '#FF8A8A'}"></i>
                                </div>
                                <h3 class="achievement-title">${achievement.title}</h3>
                                <p class="achievement-description">${achievement.description}</p>
                                <div class="achievement-progress">
                                    ${achievement.current}/${achievement.required}
                                    <div class="progress-bar" style="--progress: ${progress}%"></div>
                                </div>
                                <div style="margin-top: 0.5rem; font-size: 0.8rem; color: #666;">
                                    +${achievement.xp} XP
                                </div>
                            </div>
                        `;
                    });

                    // Update achievements count
                    const achievementsHeader = document.querySelector('.achievements-header span');
                    if (achievementsHeader) {
                        achievementsHeader.textContent = `${unlockedCount}/4 Unlocked`;
                    }
                }

                // Load drafts
                const draftsRef = databaseRef(db, 'drafts/' + user.uid);
                const draftsSnapshot = await get(draftsRef);
                const draftsGrid = document.getElementById('draftsGrid');
                
                if (draftsGrid) {
                    draftsGrid.innerHTML = '';
                    
                    if (draftsSnapshot.exists()) {
                        const drafts = [];
                        draftsSnapshot.forEach((draft) => {
                            drafts.push({ id: draft.key, ...draft.val() });
                        });

                        // Sort drafts by last modified date
                        drafts.sort((a, b) => b.lastModified - a.lastModified);

                        drafts.forEach(draft => {
                            draftsGrid.innerHTML += `
                                <div class="draft-card">
                                    <img src="${draft.thumbnail || `https://picsum.photos/seed/${draft.id}/600/400`}" alt="Draft thumbnail" class="card-image">
                <div class="card-content">
                                        <h3 class="card-title">${draft.title || 'Untitled Draft'}</h3>
                                        <p class="card-description">${draft.excerpt || draft.content?.substring(0, 100) || ''}...</p>
                    <div class="card-meta">
                                            <span>Last modified: ${new Date(draft.lastModified).toLocaleDateString()}</span>
                                            <button class="btn btn-primary" onclick="editDraft('${draft.id}')">Continue Writing</button>
                        </div>
                    </div>
                        </div>
                    `;
                        });
                    } else {
                        draftsGrid.innerHTML = `
                            <div style="text-align: center; grid-column: 1/-1; padding: 2rem; color: #666;">
                                No drafts yet
                            </div>
                        `;
                    }
                }

                // Load user's posts
                const postsRef = databaseRef(db, 'posts');
                const postsSnapshot = await get(postsRef);
                const postsGrid = document.querySelector('.posts-grid');
                
                if (postsGrid) {
                    postsGrid.innerHTML = '';
                    const posts = [];
                    
                    if (postsSnapshot.exists()) {
                        postsSnapshot.forEach((post) => {
                            const postData = post.val();
                            if (postData.data && postData.data.author === user.uid) {
                                posts.push({ 
                                    id: post.key,
                                    ...postData.data
                                });
                            }
                        });

                        if (posts.length > 0) {
                            // Sort posts by timestamp
                            posts.sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0));

                            posts.forEach(post => {
                                postsGrid.innerHTML += `
                                    <div class="post-card" onclick="window.location.href='read.html?id=${post.id}'">
                                        <img src="${post.thumbnail || `https://picsum.photos/seed/${post.id}/600/400`}" alt="Post thumbnail" class="card-image">
                                        <div class="card-content">
                                            <h3 class="card-title">${post.title || 'Untitled'}</h3>
                                            <p class="card-description">${post.plainText?.substring(0, 100) || 'No content available'}...</p>
                                            <div class="card-meta">
                                                <span>${new Date(post.timestamp || Date.now()).toLocaleDateString()}</span>
                                                <div class="stats-row">
                                                    <span><i class="far fa-eye"></i> ${post.views || 0}</span>
                                                    <span><i class="far fa-heart"></i> ${post.likes || 0}</span>
                                                    <span><i class="far fa-comment"></i> ${post.comments?.length || 0}</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                `;
                            });
                        } else {
                            postsGrid.innerHTML = `
                                <div style="text-align: center; grid-column: 1/-1; padding: 2rem; color: #666;">
                                    No posts yet. Start writing your first post!
                                </div>
                            `;
                        }
                    }
                }

                // Load insights data
                await loadInsights(user.uid);

                } catch (error) {
                console.error('Error loading profile:', error);
                showError('Failed to load profile data');
                } finally {
                if (loadingOverlay) {
                    loadingOverlay.style.display = 'none';
                }
            }
        }

        async function loadInsights(userId) {
            try {
                const postsRef = databaseRef(db, 'posts');
                const postsSnapshot = await get(postsRef);
                
                let totalViews = 0;
                let totalLikes = 0;
                let totalComments = 0;
                let totalReadTime = 0;
                const posts = [];

                if (postsSnapshot.exists()) {
                    postsSnapshot.forEach((post) => {
                        const postData = post.val();
                        if (postData.authorId === userId) {
                            totalViews += postData.views || 0;
                            totalLikes += postData.likes?.length || 0;
                            totalComments += postData.comments?.length || 0;
                            totalReadTime += postData.readTime || 0;
                            posts.push({ id: post.key, ...postData });
                        }
                    });
                }

                // Helper function to update element text content
                function updateElement(id, value) {
                    const element = document.getElementById(id);
                    if (element) {
                        element.textContent = value;
                    }
                }

                // Update insights stats
                updateElement('totalViews', totalViews);
                updateElement('totalReadTime', totalReadTime);
                updateElement('totalLikes', totalLikes);
                updateElement('totalComments', totalComments);
                updateElement('interactionRate', 
                    totalViews > 0 ? Math.round((totalLikes + totalComments) / totalViews * 100) + '%' : '0%'
                );
                updateElement('avgReadTime',
                    posts.length > 0 ? Math.round(totalReadTime / posts.length) : 0
                );

                // Update popular articles
                const popularArticles = document.getElementById('popularArticles');
                if (popularArticles) {
                    // Sort posts by views
                    posts.sort((a, b) => (b.views || 0) - (a.views || 0));
                    popularArticles.innerHTML = posts.length > 0 ? posts.slice(0, 5).map((post, index) => `
                        <div class="popular-article-item">
                            <div class="article-rank">#${index + 1}</div>
                            <div class="article-info">
                                <div class="article-title">${post.title}</div>
                                <div class="article-stats">
                                    <span><i class="fas fa-eye"></i> ${post.views || 0}</span>
                                    <span><i class="fas fa-heart"></i> ${post.likes?.length || 0}</span>
                                    <span><i class="fas fa-comment"></i> ${post.comments?.length || 0}</span>
                                </div>
                            </div>
                        </div>
                    `).join('') : `
                        <div style="text-align: center; padding: 2rem; color: #666;">
                            No posts yet
                        </div>
                    `;
                }

            } catch (error) {
                console.error('Error loading insights:', error);
                // Show error state in insights
                const elements = ['totalViews', 'totalReadTime', 'totalLikes', 'totalComments', 'interactionRate', 'avgReadTime'];
                elements.forEach(id => {
                    const element = document.getElementById(id);
                    if (element) element.textContent = '-';
                });

                const popularArticles = document.getElementById('popularArticles');
                if (popularArticles) {
                    popularArticles.innerHTML = `
                        <div style="text-align: center; padding: 2rem; color: #666;">
                            Error loading insights. Please try again later.
                        </div>
                    `;
                }
            }
        }

        window.previewImage = function(event) {
            const file = event.target.files[0];
            const defaultAvatar = document.getElementById('defaultAvatar');
            const avatarPreview = document.getElementById('avatarPreview');
            
            if (file) {
                // Validate file size
                if (file.size > 5 * 1024 * 1024) { // 5MB
                    showToast('Image size should be less than 5MB', 'error');
                    return;
                }

                // Validate file type
                if (!file.type.startsWith('image/')) {
                    showToast('Please select an image file', 'error');
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    // Create a new image to check dimensions
                    const img = new Image();
                    img.onload = function() {
                        // Check if image is reasonably square
                        const ratio = this.width / this.height;
                        if (ratio < 0.75 || ratio > 1.33) {
                            showToast('For best results, use a square image', 'warning');
                        }
                        
                        // Show preview
                        defaultAvatar.style.display = 'none';
                        avatarPreview.style.display = 'block';
                        avatarPreview.src = e.target.result;
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            } else {
                // Reset to default
                defaultAvatar.style.display = 'flex';
                avatarPreview.style.display = 'none';
                avatarPreview.src = '';
            }
        };

        function showError(message) {
            console.error(message);
            showToast(message, 'error');
        }
    </script>
</body>
</html>